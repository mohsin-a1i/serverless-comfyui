<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runpod ComfyUI</title>
    <style>
        body { 
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #2F2F2F;
        }
        img { 
            max-width: 300px; 
            display: block; 
            margin: 10px;
            border-radius: 5px;
        }
        button { 
            margin: 10px; 
            padding: 10px 20px; 
            font-size: 16px; 
            background-color: #76B900;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            outline: none;
        }
        input[type="file"] {
            display: none;
        }
        label {  
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            background-color: #ffffff;
            color: #000000;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <input type="file" id="image" accept="image/*">
    <label for="image">Select starting image</label>
    <button id="animateButton">Animate</button>

    <img id="preview">

    <script>
        const imageInput = document.getElementById('image');
        const previewImg = document.getElementById('preview');

        const animateButton = document.getElementById('animateButton');
        const responseOutput = document.getElementById('responseOutput');

        const requestHeaders = {
            "Content-Type": "application/json",
            "Authorization": "Bearer <token>"
        }

        const setPreview = () => {
            const file = imageInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = () => {
                const base64String = reader.result;
                previewImg.src = base64String;
            };
            reader.readAsDataURL(file);
        }

        const pollJob = async (jobId) => {
            const response = await fetch("https://api.runpod.ai/v2/osqu2dne1k9jg7/status/" + jobId, {
                method: "GET",
                headers: requestHeaders,
            })
            if (!response.ok) throw new Error(response.text())
            const data = await response.json()

            if (["IN_QUEUE", "IN_PROGRESS"].includes(data.status)) setTimeout(() => pollJob(data.id), 10000);
            else console.log(JSON.stringify(data, null, 2));
        }

        const queueJob = async () => {
            if (!previewImg.src) {
                alert('Select a starting image');
                return;
            }

            const response = await fetch("https://api.runpod.ai/v2/osqu2dne1k9jg7/run", {
                method: "POST",
                headers: requestHeaders,
                body: JSON.stringify({
                    "input" : {
                        "workflow": JSON.parse(document.getElementById('workflow').textContent),
                        "images": [{
                            "name": "input.png",
                            "image": previewImg.src
                        }]
                    }
                })
            });
            if (!response.ok) throw new Error(response.text());

            const data = await response.json();
            if (["IN_QUEUE", "IN_PROGRESS"].includes(data.status)) setTimeout(() => pollJob(data.id), 10000);
            else console.log(JSON.stringify(data, null, 2));
        }

        imageInput.addEventListener('change', setPreview);
        animateButton.addEventListener('click', queueJob);
    </script>

    <script type="application/json" id="workflow">
        {"84":{"inputs":{"clip_name":"umt5_xxl_fp16.safetensors","type":"wan","device":"default"},"class_type":"CLIPLoader","_meta":{"title":"LoadCLIP"}},"85":{"inputs":{"add_noise":"disable","noise_seed":0,"steps":4,"cfg":1,"sampler_name":"euler","scheduler":"simple","start_at_step":2,"end_at_step":4,"return_with_leftover_noise":"disable","model":["103",0],"positive":["98",0],"negative":["98",1],"latent_image":["86",0]},"class_type":"KSamplerAdvanced","_meta":{"title":"KSampler(Advanced)"}},"86":{"inputs":{"add_noise":"enable","noise_seed":138073435077572,"steps":4,"cfg":1,"sampler_name":"euler","scheduler":"simple","start_at_step":0,"end_at_step":2,"return_with_leftover_noise":"enable","model":["104",0],"positive":["98",0],"negative":["98",1],"latent_image":["98",2]},"class_type":"KSamplerAdvanced","_meta":{"title":"KSampler(Advanced)"}},"87":{"inputs":{"samples":["85",0],"vae":["90",0]},"class_type":"VAEDecode","_meta":{"title":"VAEDecode"}},"89":{"inputs":{"text":"色调艳丽，过曝，静态，细节模糊不清，字幕，风格，作品，画作，画面，静止，整体发灰，最差质量，低质量，JPEG压缩残留，丑陋的，残缺的，多余的手指，画得不好的手部，画得不好的脸部，畸形的，毁容的，形态畸形的肢体，手指融合，静止不动的画面，杂乱的背景，三条腿，背景人很多，倒着走","clip":["84",0]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIPTextEncode(NegativePrompt)"}},"90":{"inputs":{"vae_name":"Wan2_1_VAE_bf16.safetensors"},"class_type":"VAELoader","_meta":{"title":"LoadVAE"}},"93":{"inputs":{"text":"Thegirldances","clip":["84",0]},"class_type":"CLIPTextEncode","_meta":{"title":"CLIPTextEncode(PositivePrompt)"}},"94":{"inputs":{"fps":16,"images":["87",0]},"class_type":"CreateVideo","_meta":{"title":"CreateVideo"}},"95":{"inputs":{"unet_name":"Wan2_2-I2V-A14B-HIGH_bf16.safetensors","weight_dtype":"default"},"class_type":"UNETLoader","_meta":{"title":"LoadDiffusionModel"}},"96":{"inputs":{"unet_name":"Wan2_2-I2V-A14B-LOW_bf16.safetensors","weight_dtype":"default"},"class_type":"UNETLoader","_meta":{"title":"LoadDiffusionModel"}},"97":{"inputs":{"image":"input-18.jpg"},"class_type":"LoadImage","_meta":{"title":"LoadImage"}},"98":{"inputs":{"width":1024,"height":1344,"length":81,"batch_size":1,"positive":["93",0],"negative":["89",0],"vae":["90",0],"start_image":["97",0]},"class_type":"WanImageToVideo","_meta":{"title":"WanImageToVideo"}},"101":{"inputs":{"lora_name":"wan2.2_i2v_A14b_high_noise_lora_rank64_lightx2v_4step_1022.safetensors","strength_model":1.0000000000000002,"model":["95",0]},"class_type":"LoraLoaderModelOnly","_meta":{"title":"LoraLoaderModelOnly"}},"102":{"inputs":{"lora_name":"wan2.2_i2v_A14b_low_noise_lora_rank64_lightx2v_4step_1022.safetensors","strength_model":1.0000000000000002,"model":["96",0]},"class_type":"LoraLoaderModelOnly","_meta":{"title":"LoraLoaderModelOnly"}},"103":{"inputs":{"shift":5.000000000000001,"model":["102",0]},"class_type":"ModelSamplingSD3","_meta":{"title":"ModelSamplingSD3"}},"104":{"inputs":{"shift":5.000000000000001,"model":["101",0]},"class_type":"ModelSamplingSD3","_meta":{"title":"ModelSamplingSD3"}},"108":{"inputs":{"filename_prefix":"video/ComfyUI","format":"auto","codec":"auto","video":["94",0]},"class_type":"SaveVideo","_meta":{"title":"SaveVideo"}}}
    </script>
</body>
</html>
